@using Project.AppCore.Store
@using Project.Constraints.UI.Flyout
@using Project.Constraints.UI.Form
@using Project.Models.Entities.Permissions
@using MT.Toolkit.StringExtension;
@inherits DialogTemplate<UserPwd>

@if (options != null)
{
    @UI.BuildForm(options)
}

@code {
    FormOptions<UserPwd> options;
    protected override void OnInitialized()
    {
        base.OnInitialized();
        options = FormBuilder.Create<UserPwd>().Build<UserPwd>(UI, Value);
    }

    public override Task<bool> OnPostAsync()
    {
        if (!(options?.Validate() ?? false))
        {
            return Task.FromResult(false);
        }
        if (User.UserInfo?.Password != Value.OldPassword)
        {
            UI.Error(GetLocalizeString("OldPasswordError"));
            return Task.FromResult(false);
        }
        if (Value.Password != Value.ConfirmPassword)
        {
            UI.Error(GetLocalizeString("PasswordDifference"));
            return Task.FromResult(false);
        }
        return base.OnPostAsync();
    }
}

